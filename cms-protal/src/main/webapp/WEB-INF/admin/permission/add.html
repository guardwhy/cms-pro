<#import "/layout/backend/main.ftl" as main>
<#import "/layout/backend/form.ftl" as form>
<@main.layout>
  <@form.form>
    <@form.item>
      <@form.inline label="上级菜单">
        <ul id="tree"></ul>
      </@form.inline>
      <@form.inline label="权限名称" required=true>
        <input name="name" class="layui-input" type="text">
      </@form.inline>
    </@form.item>
    <@form.item>
      <@form.inline label="权限类型" required=true>
        <#--默认值-->
        <@form.radio list=permissionType name="menu" value="1"></@form.radio>
      </@form.inline>
      <@form.inline label="菜单url">
        <input name="url" class="layui-input" type="text">
      </@form.inline>
    </@form.item>
    <@form.item>
      <@form.inline label="权限标识">
        <input name="action" class="layui-input" type="text">
      </@form.inline>
      <@form.inline label="菜单图标">
        <input name="icon" class="layui-input" type="text">
      </@form.inline>
    </@form.item>
    <@form.item>
      <@form.inline label="排序" required=true>
        <input name="priority" class="layui-input" type="number">
      </@form.inline>
    </@form.item>
    <@form.submit></@form.submit>
  </@form.form>
</@main.layout>

<#--导入CSS-->
<link rel="stylesheet" href="${basePath}/admin/layui/layui_ext/dtree/dtree_select_tree.css">
<link rel="stylesheet" href="${basePath}/admin/layui/layui_ext/dtree/font/dtreefont.css">


<script>
  // 下拉树选项
  let selectTreeOption = {
    elem: "#tree",
    url: "${adminPath}/permission/selectTree.do",
    dataType: "json",
    async: false,
    method: 'post',
    ficon: ["1", "-1"],
    dataStyle: "layuiStyle",
    initLevel: 1,
    width: "100%",
    dot: false,
    checkbar: false,
    formatter: {
      title: function (data) {
        let s = data.name;
        if (data.children) {
          s += ' <span style=\'color:blue\'>(' + data.children.length + ')</span>';
        }
        return s;
      }
    },
    response: {
      statusCode: 200,
      statusName: "restCode",
      treeId: "id",
      message: "restCode",
      rootName: "data",
      title: 'name'
    },
  };

  // 引入dtree
  layui.extend({
    dtree:'{/}' + BASE_PATH + "/admin/layui/lay/modules/selectTree"
  }).use('dtree', function (){
    // 获取dtree
    let dtree = layui.dtree;
    dtree.renderSelect(selectTreeOption);
    // 获取dtree的id值
    dtree.on("node('tree')", function (obj){
      console.log(obj.param.nodeId)
    })
  });

  <#--layutil初始化-->
  LayUtil.form.init(function (form){
    form.submit(function (data){
      core.http({url:"add.do", data:data.field})
    })
  })
</script>